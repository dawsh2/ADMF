2025-05-20 13:31:26,277 - PortfolioResetSimpleTest - INFO - Starting simplified portfolio reset test
2025-05-20 13:31:26,277 - src.core.config - INFO - SimpleConfigLoader instance 4378994944 creating for config/config.yaml.
2025-05-20 13:31:26,281 - src.core.config - INFO - ConfigLoader 4378994944: Raw configuration data loaded (id: 4379440640): {'system': {'name': 'ADMF-Trader-MVP', 'version': '0.1.0'}, 'logging': {'level': 'INFO'}, 'components': {'dummy_service': {'some_setting': 'Dummy setting'}, 'ensemble_strategy': {'symbol': 'SPY', 'short_window_default': 10, 'long_window_default': 20, 'ma_rule.weight': 0.6, 'rsi_indicator': {'period': 14}, 'rsi_rule': {'oversold_threshold': 30.0, 'overbought_threshold': 70.0, 'weight': 0.4}}, 'regime_adaptive_strategy': {'symbol': 'SPY', 'short_window_default': 10, 'long_window_default': 20, 'ma_rule.weight': 0.6, 'regime_detector_service_name': 'MyPrimaryRegimeDetector', 'regime_params_file_path': 'regime_optimized_parameters.json', 'fallback_to_overall_best': True}, 'data_handler_csv': {'csv_file_path': 'data/SPY_1min.csv', 'symbol': 'SPY', 'timestamp_column': 'timestamp', 'train_test_split_ratio': 0.8, 'open_column': 'Open', 'high_column': 'High', 'low_column': 'Low', 'close_column': 'Close', 'volume_column': 'Volume'}, 'basic_portfolio': {'initial_cash': 100000.0}, 'basic_risk_manager': {'target_trade_quantity': 100}, 'simulated_execution_handler': {'default_quantity': 100, 'commission_per_trade': 0.005, 'commission_type': 'per_share', 'passthrough': False, 'fill_price_logic': 'signal_price'}, 'optimizer': {'strategy_service_name': 'strategy', 'portfolio_service_name': 'portfolio_manager', 'data_handler_service_name': 'data_handler', 'risk_manager_service_name': 'risk_manager', 'execution_handler_service_name': 'execution_handler', 'metric_to_optimize': 'get_final_portfolio_value', 'higher_metric_is_better': True, 'min_trades_per_regime': 5, 'regime_metric': 'sharpe_ratio', 'output_file_path': 'regime_optimized_parameters.json'}, 'MyPrimaryRegimeDetector': {'min_regime_duration': 2, 'indicators': {'rsi_14': {'type': 'rsi', 'parameters': {'period': 14}}, 'atr_20': {'type': 'atr', 'parameters': {'period': 10}}, 'trend_10_30': {'type': 'simple_ma_trend', 'parameters': {'short_period': 5, 'long_period': 20}}}, 'regime_thresholds': {'trending_up_volatile': {'trend_10_30': {'min': 0.02}, 'atr_20': {'min': 0.15}}, 'trending_up_low_vol': {'trend_10_30': {'min': 0.02}, 'atr_20': {'max': 0.15}}, 'ranging_low_vol': {'trend_10_30': {'min': -0.01, 'max': 0.01}, 'atr_20': {'max': 0.12}}, 'trending_down': {'trend_10_30': {'max': -0.01}}, 'oversold_in_uptrend': {'rsi_14': {'max': 40}, 'trend_10_30': {'min': 0.01}}}}}}
2025-05-20 13:31:26,281 - src.core.config - INFO - ConfigLoader 4378994944: Shielded _config_data created (id: 4379440704). Content: {'system': {'name': 'ADMF-Trader-MVP', 'version': '0.1.0'}, 'logging': {'level': 'INFO'}, 'components': {'dummy_service': {'some_setting': 'Dummy setting'}, 'ensemble_strategy': {'symbol': 'SPY', 'short_window_default': 10, 'long_window_default': 20, 'ma_rule.weight': 0.6, 'rsi_indicator': {'period': 14}, 'rsi_rule': {'oversold_threshold': 30.0, 'overbought_threshold': 70.0, 'weight': 0.4}}, 'regime_adaptive_strategy': {'symbol': 'SPY', 'short_window_default': 10, 'long_window_default': 20, 'ma_rule.weight': 0.6, 'regime_detector_service_name': 'MyPrimaryRegimeDetector', 'regime_params_file_path': 'regime_optimized_parameters.json', 'fallback_to_overall_best': True}, 'data_handler_csv': {'csv_file_path': 'data/SPY_1min.csv', 'symbol': 'SPY', 'timestamp_column': 'timestamp', 'train_test_split_ratio': 0.8, 'open_column': 'Open', 'high_column': 'High', 'low_column': 'Low', 'close_column': 'Close', 'volume_column': 'Volume'}, 'basic_portfolio': {'initial_cash': 100000.0}, 'basic_risk_manager': {'target_trade_quantity': 100}, 'simulated_execution_handler': {'default_quantity': 100, 'commission_per_trade': 0.005, 'commission_type': 'per_share', 'passthrough': False, 'fill_price_logic': 'signal_price'}, 'optimizer': {'strategy_service_name': 'strategy', 'portfolio_service_name': 'portfolio_manager', 'data_handler_service_name': 'data_handler', 'risk_manager_service_name': 'risk_manager', 'execution_handler_service_name': 'execution_handler', 'metric_to_optimize': 'get_final_portfolio_value', 'higher_metric_is_better': True, 'min_trades_per_regime': 5, 'regime_metric': 'sharpe_ratio', 'output_file_path': 'regime_optimized_parameters.json'}, 'MyPrimaryRegimeDetector': {'min_regime_duration': 2, 'indicators': {'rsi_14': {'type': 'rsi', 'parameters': {'period': 14}}, 'atr_20': {'type': 'atr', 'parameters': {'period': 10}}, 'trend_10_30': {'type': 'simple_ma_trend', 'parameters': {'short_period': 5, 'long_period': 20}}}, 'regime_thresholds': {'trending_up_volatile': {'trend_10_30': {'min': 0.02}, 'atr_20': {'min': 0.15}}, 'trending_up_low_vol': {'trend_10_30': {'min': 0.02}, 'atr_20': {'max': 0.15}}, 'ranging_low_vol': {'trend_10_30': {'min': -0.01, 'max': 0.01}, 'atr_20': {'max': 0.12}}, 'trending_down': {'trend_10_30': {'max': -0.01}}, 'oversold_in_uptrend': {'rsi_14': {'max': 40}, 'trend_10_30': {'min': 0.01}}}}}}
2025-05-20 13:31:26,281 - src.core.config - INFO - ConfigLoader 4378994944 initialized. Shielded config ready. Loaded from 'config/config.yaml'.
2025-05-20 13:31:26,281 - src.core.container - INFO - DI Container initialized.
2025-05-20 13:31:26,281 - src.core.event_bus - INFO - EventBus initialized.
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Creating BasicPortfolio instance
2025-05-20 13:31:26,281 - component.TestPortfolio - INFO - Attempting to load specific config for 'TestPortfolio' using key: 'basic_portfolio'
2025-05-20 13:31:26,281 - src.core.config - INFO - ConfigLoader 4378994944: [[[[[ SimpleConfigLoader.get() CALLED for key: 'basic_portfolio' (type: <class 'str'>) ]]]]]
2025-05-20 13:31:26,281 - src.core.config - INFO - ConfigLoader 4378994944: Accessing _config_data (shielded copy, id: 4379440704). Available top-level keys: ['system', 'logging', 'components']
2025-05-20 13:31:26,281 - src.core.config - INFO - ConfigLoader 4378994944: Processing as TOP-LEVEL key: 'basic_portfolio'
2025-05-20 13:31:26,281 - src.core.config - INFO - ConfigLoader 4378994944: Top-level key 'basic_portfolio' NOT IN _config_data (shielded). Returning default_value.
2025-05-20 13:31:26,281 - component.TestPortfolio - WARNING - No specific configuration found for key 'basic_portfolio' for component 'TestPortfolio'. Using empty config. `get` returned None.
2025-05-20 13:31:26,281 - component.TestPortfolio - INFO - Component 'TestPortfolio' created. State: CREATED
2025-05-20 13:31:26,281 - component.TestPortfolio - INFO - BasicPortfolio 'TestPortfolio' initialized with initial cash: 100000.00
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - === Initial Portfolio State ===
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Initial cash: 100000.00
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Current cash: 100000.00
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Current total value: 100000.00
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Open positions: {}
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Realized P&L: 0.00
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - === Modifying Portfolio State ===
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Portfolio after simulated trading:
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Current cash: 50000.00
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Current total value: 110000.00
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Open positions: 1 positions
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - Realized P&L: 10000.00
2025-05-20 13:31:26,281 - PortfolioResetSimpleTest - INFO - === Resetting Portfolio ===
2025-05-20 13:31:26,281 - component.TestPortfolio - INFO - Resetting portfolio 'TestPortfolio' to initial state
2025-05-20 13:31:26,281 - component.TestPortfolio - INFO - 'TestPortfolio' initiating closing of all open positions at 2025-05-20 20:31:26.281986+00:00.
2025-05-20 13:31:26,282 - component.TestPortfolio - WARNING - No close price available for 'SPY' to synthetically close. Using its current segment entry price 500.0.
2025-05-20 13:31:26,282 - component.TestPortfolio - WARNING - This may result in zero P&L for this position, which could cause equity miscalculations.
2025-05-20 13:31:26,282 - component.TestPortfolio - INFO - Synthetically closing position for SPY: SELL 100.00 at 500.00.
2025-05-20 13:31:26,282 - component.TestPortfolio - INFO - Closed LONG segment 100.00 SPY at 500.00 (entry 500.00). PnL: 0.00 in regime 'trending_up'.
2025-05-20 13:31:26,282 - component.TestPortfolio - INFO - Boundary trade detected: LONG 100.00 SPY opened in 'trending_up' and closed in 'default'. PnL: 0.00, Segment ID: 8c2c2b93-6276-4a84-a300-3b007f9cecde
2025-05-20 13:31:26,282 - component.TestPortfolio - INFO - Position in SPY fully closed and flattened after fill processing.
2025-05-20 13:31:26,282 - component.TestPortfolio - INFO - Portfolio Update at 2025-05-20 20:31:26.281986+00:00: Cash=100000.00, Holdings Value=0.00, Total Value=100000.00, Realized PnL=10000.00, Unrealized PnL=0.00
2025-05-20 13:31:26,282 - component.TestPortfolio - INFO - Portfolio Update at 2025-05-20 20:31:26.281986+00:00: Cash=100000.00, Holdings Value=0.00, Total Value=100000.00, Realized PnL=10000.00, Unrealized PnL=0.00
2025-05-20 13:31:26,282 - component.TestPortfolio - INFO - 'TestPortfolio' finished attempting to close all open positions.
2025-05-20 13:31:26,282 - component.TestPortfolio - INFO - Portfolio 'TestPortfolio' reset successfully. Cash: 100000.00, Total Value: 100000.00
2025-05-20 13:31:26,282 - PortfolioResetSimpleTest - INFO - === Portfolio State After Reset ===
2025-05-20 13:31:26,282 - PortfolioResetSimpleTest - INFO - Initial cash: 100000.00
2025-05-20 13:31:26,282 - PortfolioResetSimpleTest - INFO - Current cash: 100000.00
2025-05-20 13:31:26,282 - PortfolioResetSimpleTest - INFO - Current total value: 100000.00
2025-05-20 13:31:26,282 - PortfolioResetSimpleTest - INFO - Open positions: {}
2025-05-20 13:31:26,282 - PortfolioResetSimpleTest - INFO - Realized P&L: 0.00
2025-05-20 13:31:26,282 - PortfolioResetSimpleTest - INFO - TEST RESULT: PASSED - Portfolio was successfully reset to initial state
2025-05-20 13:31:26,282 - PortfolioResetSimpleTest - INFO - Simplified portfolio reset test completed
